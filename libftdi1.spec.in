%{!?python_sitearch: %define python_sitearch %(%{__python} -c "from distutils.sysconfig import get_python_lib; print get_python_lib(1)")}

Summary:   Library to program and control the BRITEBLOX USB controller
Name:      libbriteblox1
Version:   @VERSION@
Release:   1
License:   LGPL for libbriteblox and GPLv2+linking exception for the C++ wrapper
Group:     System Environment/Libraries
Vendor:    Intra2net AG
Source:    http://www.intra2net.com/en/developer/libbriteblox/download/%{name}-%{version}.tar.bz2
Buildroot: /tmp/%{name}-%{version}-root
Requires:  libusb1
BuildRequires: libusb1, libusb1-devel, pkgconfig, doxygen
BuildRequires: swig python-devel
Prefix:    /usr
URL:       http://www.intra2net.com/en/developer/libbriteblox

%package   devel
Summary:   Header files and static libraries for libbriteblox1
Group:     Development/Libraries
Requires:  libbriteblox1 = %{version}, libusb1-devel

%package python
Summary: Python bindings for libbriteblox
License: LGPL
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}

%description 
Library to program and control the BRITEBLOX USB controller

%description devel
Header files and static libraries for libbriteblox1

%description python
Python bindings for libbriteblox1 generated by SWIG

%prep
%setup -q

%build

mkdir build
cd build

export CFLAGS="$RPM_OPT_FLAGS"
export CXXFLAGS="$RPM_OPT_FLAGS"
cmake -DCMAKE_INSTALL_PREFIX="%{prefix}" ../

make %{?_smp_mflags}

%install
cd build
make DESTDIR=$RPM_BUILD_ROOT install

# Remove example programs
rm -f $RPM_BUILD_ROOT/usr/bin/simple
rm -f $RPM_BUILD_ROOT/usr/bin/bitbang
rm -f $RPM_BUILD_ROOT/usr/bin/bitbang2
rm -f $RPM_BUILD_ROOT/usr/bin/bitbang_ft2232
rm -f $RPM_BUILD_ROOT/usr/bin/bitbang_cbus
rm -f $RPM_BUILD_ROOT/usr/bin/find_all
rm -f $RPM_BUILD_ROOT/usr/bin/find_all_pp
rm -f $RPM_BUILD_ROOT/usr/bin/serial_test
rm -f $RPM_BUILD_ROOT/usr/bin/baud_test

# Clean python compiled files in examples dir
find $RPM_BUILD_ROOT%{prefix}/share/libbriteblox/examples -name "*.pyc" -or -name "*.pyo" -exec rm -f \{\} \;

%clean
rm -fr $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%doc COPYING.LIB COPYING.GPL LICENSE
%{_libdir}/libbriteblox1*.so*
%{_libdir}/libbritebloxpp1*.so*

%files devel
%defattr(-,root,root)
%doc build/doc/html build/doc/man
%{_bindir}/briteblox_eeprom
%{_bindir}/libbriteblox1-config
%{prefix}/include/libbriteblox1/*.h
%{prefix}/include/libbriteblox1/*.hpp
%{prefix}/share/libbriteblox/examples/*
%{_libdir}/libbriteblox1*.*a
%{_libdir}/libbritebloxpp1*.*a
%{_libdir}/pkgconfig/*.pc
%{_libdir}/cmake/libbriteblox1/*

%files python
%defattr(-,root,root,-)
%attr(755,root,root) %{python_sitearch}/_briteblox1.so
%{python_sitearch}/briteblox1.py*
